<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autenticación Mercado Libre</title>
</head>
<body>
    <h1>Redirigiendo...</h1>
    <script>
        // Obtener el parámetro "code" de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code'); // El código de autorización

        if (code) {
            // Si encontramos el "code", hacemos la solicitud para obtener el access_token
            getAccessToken(code);
        } else {
            document.body.innerHTML = '<h1>No se pudo obtener el código de autorización.</h1>';
        }

        // Función para hacer el intercambio del "code" por el "access token"
        function getAccessToken(code) {
            const params = new URLSearchParams();
            params.append('grant_type', 'authorization_code');
            params.append('code', code);
            params.append('redirect_uri', 'https://tu_usuario.github.io/mercado-libre-mensajes/callback');  // Asegúrate de que esta URL coincida con la configurada en Mercado Libre
            params.append('client_id', 'TU_CLIENT_ID'); // Tu Client ID de Mercado Libre
            params.append('client_secret', 'TU_CLIENT_SECRET'); // Tu Client Secret de Mercado Libre

            // Solicitar el access_token de Mercado Libre
            fetch('https://api.mercadolibre.com/oauth/token', {
                method: 'POST',
                body: params
            })
            .then(response => response.json())
            .then(data => {
                if (data.access_token) {
                    document.body.innerHTML = `<h1>¡Autenticación exitosa!</h1><p>Access Token: ${data.access_token}</p>`;
                    // Aquí puedes almacenar el access token en el almacenamiento local del navegador o en un estado de la app
                    console.log(data.access_token); // El access token para hacer más peticiones a la API
                } else {
                    document.body.innerHTML = `<h1>Error al obtener el access token.</h1><p>${data.message}</p>`;
                }
            })
            .catch(error => {
                console.error('Error al obtener el token:', error);
                document.body.innerHTML = '<h1>Hubo un error al autenticarte. Intenta de nuevo más tarde.</h1>';
            });
        }
    </script>
</body>
</html>
